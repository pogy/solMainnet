const { ethers } = require("ethers");
const fs = require('fs');
const path = require('path');

const colors = require('colors');
const solc = require('solc');
const {CryptoService} = require('../../common2/util/CryptoUtil');
const {RPC_URL, CHAIN_ID, TX_EXPLORER, SYMBOL, bestGasPrice, ERC20_ADDRESS} = require('../config/BnbChain.json');
const chalk = require('chalk');

 
const provider = new ethers.providers.JsonRpcProvider(RPC_URL, CHAIN_ID);
const cryptoService = new CryptoService();
const {randomExecute} = require('../../common2/util/schedule');
const {logger} = require('../../common2/util/logger');
const {EthUtil} = require('../../common2/web3/EthUtil');
const {Airdrop} = require('../../common2/web3/Airdrop');

const {DB} = require('../../common2/util/db');
const {sleep, getRandomInt, roundToDecimals, hashCode} = require('../../common2/util/common');


const db = new DB();
const ERC_ASTER = ERC20_ADDRESS["ERC_ASTER"]["ADDRESS"];//ASTER


const execute = async (task)=> {
    logger.log('start');
    try{
       let amount = 3;
       let target_balance = await EthUtil.getTokenBalance( ERC_ASTER, task.eth_wallet_address, provider);
       if(Number(target_balance.format) >= amount){
          const message =  `${task.wallet_index}-${task.eth_wallet_address} balance ${target_balance.format} >= ${amount}`;
          logger.log(message.gray);
          return;
        }

        var airdrop = new Airdrop(task.senderPrivateKey, RPC_URL, CHAIN_ID, TX_EXPLORER);
        await airdrop.airdropToken(task.eth_wallet_address, ERC_ASTER, amount);

    }catch(err){
        logger.error(err, `${task.wallet_index}-${task.eth_wallet_address}`);
    }
}


let wallet;
// 0x8C091A48ed82F24698bee5C39dd0053Fba5A33B2. 1
// 0x662D9983823563472375C06361F90aF7B631404C
// 0xf56fc0c66db97b62fec6dde290828557a10b0dc7 剩余140个 https://testnet.narwhal.finance/staking
async function main() {
  let walletTagers = await db.get_common_airdroip_tasks('monad');//monad_fault
  let wallets = await db.get_common_airdroip_tasks('monad');//monad_fault

  await cryptoService.init();

  const signAddress = "0xF482759c8d3F1B42Fff283E61d63A1C52fe1907b";
  const senderWallet = walletTagers.filter(wallet => (signAddress == wallet.eth_wallet_address));
  if(senderWallet.length == 0){
    console.log('cannot find the sender!')
    return
  }

  const privateKey = cryptoService.decryptData(senderWallet[0].eth_wallet_private);

  // const ids = ["0x00bb372787C0dcdE102d3254fbd69C9B7024df2E"]

  const ids =["0x3E34bC64e355BF9eC6594Ad169FF58a424ac619B","0x4d326BCd3F030AD2596E28331fDb6D1a9f84e506","0xd759Df704cd7fd2EcA8a7c9f8595CA67Cc9c4242","0xd0Dcd639e135E4C329238Cb7146F82220B5d2343","0x30438C1Abe7426Db6e8B50f5fD83c414B7b1FeFd","0x00bb372787C0dcdE102d3254fbd69C9B7024df2E","0x11A3a6fe01AB6022e7904D336FfE18A4362E004A","0x674c36868118b3af2e5DCd3978Ee1a0276501764","0x180A5b233ce0a9F55f034572f2A74C2A3a37A96F","0xF4151ca83fC7eeEf072A3C8386B65D1dc70baE33","0x1B1052d1c9C2DA456652fa056b14bC9f6b3465a1","0xf56fc0c66DB97b62FEc6DdE290828557A10B0DC7","0x6e47F2D9a9F3a3004eAd3bD21Df732C97670BbF4","0x662D9983823563472375C06361F90aF7B631404C","0x9dBE03E2d98adE64D6BCD7BB33467460386C4529","0x8A032c847C3b93D19dE12eF80E474B04b506BCb8","0xc209163bbEcA0fBf539D234CEC56fEc954031FB3","0x84013bfCE81D644b7dF3293A2aEAE857f2120918","0x8C091A48ed82F24698bee5C39dd0053Fba5A33B2","0x24F9095b89384E2f38b36455393FfFf9798a5dbf"
  // ,"0xc331fcC7d4DB43d9f69A576B38aE882eed4700D8","0x8e756AA09aa056D3219Db385e220E4a151f51E31","0x516c0268344936F11Aed10ca1C84Cc6bf93972bC","0xFfdE1635654E7BC1dc5dD0b4fA6E0C60cD8A4553","0xEF5D208AF3DCbFb7F3787a80a2Dd26fc231C2cd6","0xc5b91a291E0F38eCDA17D6aa31c970a7269e0C1A","0x17f37a1a9fd4F7a425e049810b31F7cb75C8D5b7","0x479247B165bb8ec4FD42fA6e9F10b18f0AA87Af4","0x34F01657Ba85E8667773fE41944b2F25B86e24F8","0x7658d12Ffe4905f29458412a72Ce6F4A100151E2","0x582D378895a0eBC834ff08dD6dD897bd35886146","0xd8D36938F317168DF1833509F00c6b5EE93635F3","0x3E971a71050b6324E1524b8f5f0F2588A414D03F","0xcCa945dd9f752b246024c6b3880C749dB68cb438","0xC896a3D8B88F89290a2599bF927f973B20bEA4E4","0xCaecefF25e635C4Dd7f961745702E04e6c7fBfa9","0x5712E3cAbaf4B1E591DF65CF922685D420Cfa381","0xA186518B09c5663bE4Fc9d68745aE3936DEfd02e","0xF637357de3C2FCf5B9c605fd7bD490e29AEFAeC4","0x4991A127aaf93752C3C9F28862eAcd81d72881f1","0x36e185F2147e046e1b354AFfF1a7A7c274b193a5","0xF482759c8d3F1B42Fff283E61d63A1C52fe1907b","0xB82bB15f87bf5A65478Dc0f6fa9d00588091de26","0x6Dd48d4B0D4E793e67B5C1edF253C063f23Bc018","0x451851c6f662493aa0010aE80B11B312dE895C1F","0xb9677713B6b6d23e76349adA2e9131B12d10437B","0x7c0070d26ae60C780Bc7f1BAA5B1cb0F191CA5a0","0xe1D08646a5De3cB585a605409975a3283e568f4b","0x8e2692f7902A5A0448FF0A70be5DD5C5bdfaac5D","0x14608b13031D732c9454d7f478F6fB5522A7Fe3A","0x7ad30C98040B5720AB7da5d0f381c8C25443AbFc","0xeD27d760245B949edc098F4D28AAF9Aaff3BF419","0x5c79372dAB9C37a58E85345065B8636F47b0dEB9","0x13EEbeF994795DDa25E7b4B401F187F085FEaebd","0xe3A9DDE402D477eedC84dEbed414D2137698002B","0xBC84D8D675DA0F9c30f9f5C79F88a4Cc7aa9Fc8B","0x4777888Ad4b16894992Eb8A506eb32dAD36eC3FD","0x4f94aE154fd84B0cEF722F6bFa6Ab26998DbFD63","0x7341a9B0fbd13D5A6dD9db4061622e167CCefeC3","0x2646eA3D334a299D936337a669Ef042E65Cb0104","0xd7892712Ff7f5249A0e6E8e99A52De311d8648A6","0x4d56BCb1d134b3Fff7070443Dd439680A54fa68D","0x8aFAE26733A325C0eDD45fD9FdC42c120deF114B","0xfb2CF64f247B9c820fB802BcF0c90B356E96194C","0x7E90a42df6f85E2A109bA7662De44515Dc3eB36C","0x1Ad9056Df2A8dD32EF82896d8ea1C579E2B5B086","0xf3dB0227fe22cC8caefa36144E567C8D3Db956F7","0x304e534C45298ecEe08b8e6062a235fFC333029F","0xbb33926fAa91B7bfC04894601858f9df98aF292A","0xDa9aD42291dC291B35C64bc01545f2873b472D69","0x272cEA250bf2e9D01dFfD7df8A975a027B427BE7","0x9838F5F1231c577e104edcD0c141C186A4BAeC26","0x8BBAADd6c3D79E5119f6Bf353D99c9FBBA61819F","0x11Dd10a295d37Ea916c7870Df2355e3b61bF2Ba3","0xF9b981389BFe89876E658515Bd4B730688D25103","0x397fC9D2252Cc841e89716c99f517Ed815eE6707","0xF9E135E045CE5a8B8cC65Db869805A5a2B34F181","0xe445e70ab72d87EFf562600781Ee89266e6E4229","0x93d4F70AaBd7bBf576A0b27868C12d5287276D30","0x423df188f3beA1Bc657FB2886Eef4F7C663DB30E","0xBAcDd81C053E6DAdEB0bc0485D04C6159D2690aC","0x1756818168f740Cc055335ABAA768cA41C6B522D","0xa7964d345Ec06F2f46459b5420303eAF4F5ECECD","0x12832C3d6398a2dbBb3cE85b5Ea0d56F6A4Fe4A5","0xc7d28B7F45C8C9a20F380798b6Be0C8c9F6B1aA4","DiazSandra86227","0xAe7001A0febaD454402E8C71Fdf44F6989f6e240","0xBE9BC379F5448f33c61fDd244d71fB29D21e3608","0xeAbEbae4Aa281c510e3309Ac8088727ab665dbE9","0x78cf907AFa07fBb6dCB74A9D1707740AbA394aDa","0xdb785c61445ED23a9394559Cc58a8bE4c0D0092A","0x365197d33a0D56Ef625a232d5b41b1c71586045d","0x86F7154Fb9C2457338715Adef1B9b6a90db64ae3","0x96A50327Ea85cB028CFa52c36525731A0dA5c607","0x00f71b6720c568C5F857Cc53a864758d60F554e8","0x78Dff5898d717db345C75b71Ea52B05423A4b5b3","0x89AC277a590c699C6796F3F71f4D94dC3b96B507","0x761424dc5c7E5142eF1a33f2FF4526e76972bF6c","0xd50FDD4894A77ea8375A569498A2Ec8b94792dF5","0x7F64f0b9dd3CD96a1220bb5F05DccDc755C31E03","0xBaE671B235AD3d6035d7cd0239573a5af0097E78","0xB30B1b9719085Be03851BF3173FD6628447A34C4","0x8049C683aB5bcdB9565E72223fB10b5AB6fE95E5","0x38a4Eb3fDCD524b5E628fb20D57B2EC8a7665782","0x15786efED1Bac481A024C4f62AaAE30E0685DE09","0x4c706F77B7a52F0A20b02492b07635e23aF190E9","0x8ba262145CC42e651d329867CAe51517eC0cd160","0x7591230De99E9cA2Aa4033276c62F54675878c3a","0x6465394073A43Dd02e390C2E42923Ac69D10C192","0x4e092bB1207a99c25d0Fa1f8b7b34Eed5698c528","0x0BB28B8057498ee8ECa9D71A73B86C0ef037480D","0x0974Bbcb473d47aB2626B24d1e278AFbD6868f43","0x0A866cb9C098e3A5E78ffae3127D3D3B33ac9F2d","0x47Fc564E0e9910A7E42b07BeB7602691b8068447","0x2eAF2Ad11710078F791D35404685Fe7B4309F566","0x6C1554F70D74f27Aae795d5E0ce780C2F77696b5","0x3c994BEB893Ed84ea6E5F1e918cb1466bbc8fa83","0xE691Ab763063EE21407e825Ce4c22810A7924F7A","0x9bd86D74c132ad30174E349136eCb92b659e64f4","0x151387a10f96C962ed4194e48B09524E1b2Aa8Da","0x2a4b64b1Dce41984a748a9704deC7E8672371565","0x83F53F0d53e2e2Eed95bd029c77dF7Bd77Fe9F7c","0x4d292f783CA2D65d99db4A3b25A46afeF1F29f84","0x12BeD0Dd670A9A055F9Be076c490A1Cb927BD044","0x5E472044f8C423D1124F949Ec2eD06f1fC9dbb71","0xE8201617Bd2503E9cC0e076093063dD09E865Cf2","0x3d5e5c216C44c94F118fDF745Aab98673C0736b5","0xed6331CFc75AcFe537E284C199d27515bf188344","0xcD39af92a3a98f9295066A001fcDBf93C25cACFc","0x28518228c5023d9aAF16045E9794893718D563D0","0x62D5d39Cc7209c8a66334246Ef3Fa5a0629e9509","0x52e307c543e1650d67D3AB9A23752becDcD8b51D"
    ];
  wallets = wallets.filter(wallet => (ids.includes(wallet.eth_wallet_address)));
  for(let wallet of wallets){
    wallet.senderPrivateKey = privateKey;
    await execute(wallet);
    await sleep(3000 + getRandomInt(3000))
  }


  // await randomExecute(wallets, execute, 20000  * wallets.length);
    
}

// okx12_3. 1
// okx12_8.  22
// okx12_13 
// okx12_15 12
// okx12_16 1
// okx12_18. 1

main().catch(console.error);